pipeline {
    agent {
        node {
            label 'master'
        }
    }
    // triggers { upstream(upstreamProjects: 'jenkins_pipeline_example', threshold: hudson.model.Result.SUCCESS) }
    options {
        timestamps()
        disableConcurrentBuilds()
        timeout(time: 10, unit: 'SECONDS')
    }
    parameters {
        booleanParam(name: 'RunParallelStage', defaultValue: true, description: 'Run Parallel Stage')
        booleanParam(name: 'failFast', defaultValue: true, description: 'Parallel failFast')
        string(name: 'SleepDelay', defaultValue: '3', description: 'Sleep delay inside timeout')
        choice(name: 'choice', choices: ['one','two','three'], description: '')
        password(name: 'password', defaultValue: 'SECRET', description: '')
        text(name: 'text', defaultValue: 'One\nTwo\nThree\n', description: '')
    }
    stages {
       stage("Parallel") {
            when {
                expression {return params.RunParallelStage}
            }
            failFast true
            parallel {
                stage("One") {
                    steps {
                        sleep 1
                        echo 'Stage 1'
                    }
                }
                stage("Two") {
                    options {
                        timeout(time: 2, unit: 'SECONDS')
                    }
                    steps {
                        sleep params.SleepDelay.toInteger()
                        echo 'Stage 2'
                    }
                }
                stage("Three") {
                    options {
                        retry(2)
                    }
                    steps {
                        echo 'Stage 3'
                        sh 'false'
                    }
                }
            }
        }
    }
}
